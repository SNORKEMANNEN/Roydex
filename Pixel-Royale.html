<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pixel Royale â€“ Guess the card!</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Bowlby+One+SC&family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --royal-blue:#2b5fd9;
      --royal-blue-dark:#1e3ea8;
      --royal-blue-deep:#0d1d63;
      --gold:#ffcc33;
      --gold-deep:#d4a017;
      --stone:#263147;
      --ink:#0b1020;
      --success:#27c46b;
      --danger:#ff4d4d;
      --card-bg:#0d142b;
      --neon-pink: #ff0080;
      --neon-cyan: #00ffff;
      --electric-purple: #8a2be2;
    }

    /* Graphics quality handling */
    :root[data-graphics="low"] *,
    :root[data-graphics="low"] *::before,
    :root[data-graphics="low"] *::after {
      animation: none !important;
      transition: opacity 0.2s ease, transform 0.2s ease !important;
      backdrop-filter: none !important;
      filter: none !important;
    }

    :root[data-graphics="low"] .stars,
    :root[data-graphics="low"] .particles,
    :root[data-graphics="low"] .frame::before {
      display: none !important;
    }

    :root[data-graphics="low"] .frame {
      background: var(--royal-blue-dark) !important;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2) !important;
    }

    :root[data-graphics="low"] .topbar,
    :root[data-graphics="low"] .stage,
    :root[data-graphics="low"] .sidebar {
      background: rgba(13, 20, 43, 0.9) !important;
      backdrop-filter: none !important;
    }

    @font-face {
      font-family: 'Clash';
      src: url('Clash-Regular.woff2') format('woff2'),
          url('Clash-Regular.woff') format('woff');
      font-weight: normal;
      font-style: normal;
      font-display: swap;
    }
  
    *{box-sizing:border-box}
    html,body{
      height:100%;
      background: 
        radial-gradient(circle at 15% 20%, rgba(255, 0, 128, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 85% 80%, rgba(0, 255, 255, 0.08) 0%, transparent 50%),
        radial-gradient(1200px 700px at 20% -10%, #3c6eff 0%, rgba(60,110,255,0) 60%),
        radial-gradient(900px 600px at 100% 0%, #1a2a6b 0%, rgba(26,42,107,0) 60%), 
        linear-gradient(180deg, #0b1020, #141b35);
    }
    body{margin:0;color:#eef2ff;font-family:Clash,system-ui,Segoe UI,Roboto,Helvetica,Arial;overflow-x:hidden;}

    /* Enhanced animated starfield */
    .stars{
      position:fixed;
      inset:0;
      pointer-events:none;
      z-index:0;
      background-image:
        radial-gradient(2px 2px at 20% 30%,#fff8,transparent),
        radial-gradient(1.5px 1.5px at 70% 20%,#fff6,transparent),
        radial-gradient(2px 2px at 40% 70%,#fff7,transparent),
        radial-gradient(1px 1px at 90% 40%,#ff008055,transparent),
        radial-gradient(1px 1px at 10% 80%,#00ffff55,transparent);
      animation: twinkle 6s ease-in-out infinite, starMove 20s linear infinite;
    }
    
    @keyframes twinkle{
      0%, 100%{filter:brightness(1) hue-rotate(0deg)}
      25%{filter:brightness(1.3) hue-rotate(90deg)}
      50%{filter:brightness(0.8) hue-rotate(180deg)}
      75%{filter:brightness(1.1) hue-rotate(270deg)}
    }
    
    @keyframes starMove{
      0%{transform:translateY(0px)}
      100%{transform:translateY(-10px)}
    }

    /* Floating particles */
    .particles{
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 0;
      overflow: hidden;
    }

    .particle{
      position: absolute;
      width: 4px;
      height: 4px;
      background: var(--neon-cyan);
      border-radius: 50%;
      opacity: 0.6;
      animation: float 8s linear infinite;
    }

    @keyframes float{
      0%{
        transform: translateY(100vh) translateX(0px) scale(0);
        opacity: 0;
      }
      10%{
        opacity: 0.6;
        transform: scale(1);
      }
      90%{
        opacity: 0.6;
      }
      100%{
        transform: translateY(-10vh) translateX(50px) scale(0);
        opacity: 0;
      }
    }

    .wrap{
      position:relative;
      z-index:1;
      min-height:100vh;
      display:flex;
      flex-direction: column;
      justify-content: center;
      padding:10px;
      animation: slideIn 0.8s ease-out;
    }

    @keyframes slideIn{
      0%{opacity:0; transform:translateY(30px)}
      100%{opacity:1; transform:translateY(0)}
    }

    .frame{
      width:min(1000px,98vw);
      max-width: 100%;
      margin: 0 auto;
      background:linear-gradient(135deg, var(--royal-blue-dark), var(--royal-blue-deep)); 
      border-radius:20px; 
      padding:16px; 
      box-shadow:
        0 25px 60px rgba(0,0,0,0.3), 
        inset 0 0 0 2px rgba(255,255,255,0.1),
        0 0 40px rgba(59, 130, 246, 0.15); 
      position:relative; 
      overflow:hidden;
      backdrop-filter: blur(10px);
      border: 2px solid rgba(255,255,255,0.1);
      transition: all 0.3s ease;
    }

    .frame:hover{
      transform: translateY(-2px);
      box-shadow:
        0 35px 80px rgba(0,0,0,0.4), 
        inset 0 0 0 2px rgba(255,255,255,0.15),
        0 0 60px rgba(59, 130, 246, 0.2);
    }

    .frame::before{
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, var(--neon-pink), var(--neon-cyan), var(--electric-purple));
      animation: neonPulse 3s ease-in-out infinite;
    }

    @keyframes neonPulse{
      0%, 100%{opacity: 0.5}
      50%{opacity: 1}
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between; 
      gap:12px; 
      padding:12px 16px; 
      border-radius:16px; 
      background:linear-gradient(135deg,rgba(44, 68, 143, 0.8),rgba(22, 36, 94, 0.9)); 
      box-shadow: 
        inset 0 0 0 2px rgba(0,0,0,0.1), 
        0 8px 20px rgba(0,0,0,0.2),
        0 0 15px rgba(59, 130, 246, 0.1);
      backdrop-filter: blur(15px);
      border: 1px solid rgba(255,255,255,0.1);
    }

    .brand{display:flex;align-items:center;gap:12px}
    .brand .logo {
      width: 64px;
      height: 64px;
      filter: drop-shadow(0 0 8px rgba(255, 204, 51, 0.5));
      transition: all 0.3s ease;
    }
    .brand .logo:hover{
      transform: scale(1.05) rotate(5deg);
      filter: drop-shadow(0 0 12px rgba(255, 204, 51, 0.8));
    }

    .stats{display:flex;align-items:center;gap:10px;flex-wrap: wrap}
    .pill{
      display:flex;
      align-items:center;
      gap:8px; 
      padding:8px 12px; 
      border-radius:999px; 
      background:linear-gradient(135deg,rgba(20, 48, 136, 0.9),rgba(12, 26, 85, 0.9)); 
      box-shadow:inset 0 0 0 2px rgba(0,0,0,0.2), 0 4px 10px rgba(0,0,0,0.15);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.08);
      transition: all 0.3s ease;
      font-size: 14px;
    }
    .pill:hover{
      transform: translateY(-1px);
      box-shadow:inset 0 0 0 2px rgba(0,0,0,0.2), 0 6px 15px rgba(0,0,0,0.25);
    }
    .pill b{
      color:#ffe27a; 
      text-shadow:0 2px 4px rgba(0,0,0,0.5);
      font-size: 1em;
    }

    .main{
      display:grid; 
      grid-template-columns:1fr 0.7fr; 
      gap:16px; 
      margin-top:16px;
      min-height: 420px;
    }
    
    @media (max-width:900px){
      .main{grid-template-columns:1fr; gap:16px} 
      .frame{padding:12px}
    }

    .stage{
      background:linear-gradient(135deg,rgba(13, 20, 43, 0.9),rgba(16, 26, 63, 0.8)); 
      border-radius:20px; 
      padding:16px; 
      box-shadow:
        inset 0 0 0 2px rgba(0,0,0,0.1),
        0 15px 25px rgba(0,0,0,0.15),
        0 0 20px rgba(13, 20, 43, 0.3);
      backdrop-filter: blur(15px);
      border: 1px solid rgba(255,255,255,0.05);
      position: relative;
      overflow: hidden;
    }

    .stage::before{
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(45deg, transparent 49%, rgba(255,255,255,0.03) 50%, transparent 51%);
      pointer-events: none;
    }
      
    /* Optimized card area */
    .card-frame {
      width: 100%;
      max-width: 280px;
      aspect-ratio: 3/4;
      margin: 0 auto;
      position: relative;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 
        0 15px 35px rgba(0,0,0,0.3),
        0 0 25px rgba(13, 20, 43, 0.5);
      transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .card-frame:hover{
      transform: scale(1.02) translateY(-3px);
      box-shadow: 
        0 25px 50px rgba(0,0,0,0.4),
        0 0 40px rgba(13, 20, 43, 0.7);
    }

    .card-frame.revealed {
      box-shadow: 
        0 15px 35px rgba(0,0,0,0.3),
        0 0 40px rgba(39, 196, 107, 0.6),
        inset 0 0 20px rgba(39, 196, 107, 0.2);
    }

    canvas#pixelCanvas {
      width: 100%;
      height: 100%;
      display:block;
      background: var(--card-bg);
      transition: all 0.3s ease;
    }

    /* Optimized wrong guesses */
    #wrongGuesses {
      margin-top: 16px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
      gap: 8px;
      justify-items: center;
      max-height: 120px;
      overflow-y: auto;
      scrollbar-width: none;
    }

    #wrongGuesses::-webkit-scrollbar {
      display: none;
    }

    #wrongGuesses div {
      display: flex;
      flex-direction: column;
      align-items: center;
      font-size: 10px;
      padding: 6px;
      border-radius: 8px;
      background: linear-gradient(135deg, rgba(255, 77, 77, 0.1), rgba(139, 69, 19, 0.1));
      border: 1px solid rgba(255, 77, 77, 0.3);
      transition: all 0.3s ease;
      animation: wrongSlideIn 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    #wrongGuesses div:hover{
      transform: scale(1.05);
      background: linear-gradient(135deg, rgba(255, 77, 77, 0.2), rgba(139, 69, 19, 0.2));
    }

    @keyframes wrongSlideIn{
      0%{
        opacity: 0;
        transform: scale(0.5) translateY(20px);
      }
      100%{
        opacity: 1;
        transform: scale(1) translateY(0);
      }
    }

    #wrongGuesses img {
      width: 40px;
      height: auto;
      border-radius: 6px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      transition: all 0.3s ease;
    }

    #wrongGuesses img:hover{
      transform: scale(1.1);
    }

    .next-tag{
      position:absolute; 
      top:10px; 
      right:-50px; 
      transform:rotate(30deg); 
      background:linear-gradient(135deg,var(--gold),var(--gold-deep)); 
      color:#381f00; 
      font-weight:800; 
      padding:6px 60px; 
      box-shadow:0 6px 15px rgba(0,0,0,0.3); 
      text-shadow:none; 
      border-radius:8px;
      animation: tagPulse 2s ease-in-out infinite;
      font-size: 14px;
    }

    @keyframes tagPulse{
      0%, 100%{transform: rotate(30deg) scale(1)}
      50%{transform: rotate(30deg) scale(1.05)}
    }

    /* Optimized sidebar */
    .sidebar{
      background:linear-gradient(135deg,rgba(13, 20, 43, 0.9),rgba(18, 27, 62, 0.8)); 
      border-radius:20px; 
      padding:16px; 
      box-shadow:
        inset 0 0 0 2px rgba(0,0,0,0.1),
        0 15px 25px rgba(0,0,0,0.15); 
      display:grid; 
      gap:12px;
      backdrop-filter: blur(15px);
      border: 1px solid rgba(255,255,255,0.05);
      align-content: start;
    }

    .guess-row{display:flex; gap:8px}
    .input{
      flex:1; 
      background:rgba(11, 19, 43, 0.8); 
      border:2px solid rgba(27, 42, 92, 0.8); 
      color:#e7ecff; 
      border-radius:12px; 
      padding:12px 14px; 
      outline:0; 
      font-weight:600; 
      box-shadow:0 6px 12px rgba(0,0,0,0.15); 
      transition:.3s ease;
      backdrop-filter: blur(10px);
      font-family: inherit;
      font-size: 14px;
    }
    .input:focus{
      border-color:#4e7dff; 
      box-shadow:0 8px 20px rgba(0,0,0,0.2), 0 0 0 3px rgba(78, 125, 255, 0.2);
      transform: translateY(-1px);
    }

    .btn{
      appearance:none; 
      border:0; 
      background:linear-gradient(135deg,#ffd86b,#caa141); 
      color:#2b1a00; 
      font-family:inherit; 
      font-weight:900; 
      letter-spacing:.5px; 
      padding: 10px 16px; 
      border-radius:12px; 
      box-shadow:0 8px 0 #7d5a13, 0 12px 25px rgba(0,0,0,0.2); 
      transform:translateY(0); 
      transition:all .3s cubic-bezier(0.34, 1.56, 0.64, 1);
      cursor: pointer;
      position: relative;
      overflow: hidden;
      font-size: 14px;
    }

    .btn::before{
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      transition: left 0.5s ease;
    }

    .btn:hover{
      transform:translateY(-2px) scale(1.02); 
      filter:saturate(1.2) brightness(1.1);
      box-shadow:0 10px 0 #7d5a13, 0 16px 35px rgba(0,0,0,0.3);
    }

    .btn:hover::before{
      left: 100%;
    }

    .btn:active{
      transform:translateY(2px) scale(0.98); 
      box-shadow:0 4px 0 #7d5a13, 0 6px 12px rgba(0,0,0,0.25);
    }

    /* Compact status section */
    .status{display:grid; gap:8px; font-size:13px}
    .bar{
      height:12px; 
      background:rgba(10, 20, 51, 0.8); 
      border:2px solid rgba(0,0,0,0.2); 
      border-radius:999px; 
      overflow:hidden;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.3);
    }
    .bar > div{
      height:100%; 
      background:linear-gradient(90deg,#46f28f,#2cd2ff,#ff6b9d); 
      width:0;
      transition: all 0.5s ease;
      position: relative;
      overflow: hidden;
    }

    .bar > div::after{
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      animation: barShimmer 2s linear infinite;
    }

    @keyframes barShimmer{
      0%{transform: translateX(-100%)}
      100%{transform: translateX(100%)}
    }

    /* Enhanced toast */
    .toast{
      position:fixed; 
      inset:auto 0 20px 0; 
      display:grid; 
      place-items:center; 
      pointer-events:none; 
      z-index:100;
    }
    .toast .msg{
      pointer-events:auto; 
      padding:12px 20px; 
      border-radius:12px; 
      background:rgba(13, 20, 43, 0.95); 
      border:2px solid rgba(27, 42, 92, 0.8); 
      box-shadow:0 15px 35px rgba(0,0,0,0.3);
      backdrop-filter: blur(20px);
      animation: toastSlideUp 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
      font-weight: 600;
      text-align: center;
      font-size: 14px;
    }

    @keyframes toastSlideUp{
      0%{
        opacity: 0;
        transform: translateY(50px) scale(0.9);
      }
      100%{
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    /* Enhanced animations */
    .shake{animation:enhancedShake .8s ease-in-out}
    @keyframes enhancedShake{
      0%, 100%{transform:translateX(0) rotate(0deg)}
      10%{transform:translateX(-8px) rotate(-2deg)}
      20%{transform:translateX(8px) rotate(2deg)}
      30%{transform:translateX(-12px) rotate(-3deg)}
      40%{transform:translateX(12px) rotate(3deg)}
      50%{transform:translateX(-8px) rotate(-2deg)}
      60%{transform:translateX(8px) rotate(2deg)}
      70%{transform:translateX(-4px) rotate(-1deg)}
      80%{transform:translateX(4px) rotate(1deg)}
      90%{transform:translateX(-2px) rotate(0deg)}
    }

    .success-glow{
      animation: successGlow 1.5s ease-out;
    }

    @keyframes successGlow{
      0%{
        box-shadow: 0 15px 35px rgba(0,0,0,0.3), 0 0 25px rgba(13, 20, 43, 0.5);
      }
      50%{
        box-shadow: 
          0 15px 35px rgba(0,0,0,0.3), 
          0 0 40px rgba(39, 196, 107, 0.8),
          inset 0 0 20px rgba(39, 196, 107, 0.3);
      }
      100%{
        box-shadow: 0 15px 35px rgba(0,0,0,0.3), 0 0 25px rgba(13, 20, 43, 0.5);
      }
    }

    .confetti{position:absolute; inset:0; pointer-events:none; overflow:hidden; border-radius: 16px;}

    /* Loading screen */
    .loading-screen {
      position: fixed;
      inset: 0;
      background: linear-gradient(135deg, #0b1020, #141b35);
      display: grid;
      place-items: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.5s ease;
    }

    .loading-screen.active {
      opacity: 1;
      visibility: visible;
    }

    .loading-content {
      text-align: center;
      color: #eef2ff;
    }

    .loading-spinner {
      width: 50px;
      height: 50px;
      border: 4px solid rgba(255, 204, 51, 0.3);
      border-top: 4px solid #ffcc33;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 16px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Compact autocomplete */
    #autocomplete {
      display: grid;
      gap: 4px;
      max-height: 180px;
      overflow-y: auto;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }

    #autocomplete::-webkit-scrollbar {
      display: none;
    }

    .autocomplete-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 12px;
      font-size: 0.85rem;
      border-radius: 10px;
      background: linear-gradient(135deg, rgba(20, 48, 136, 0.6), rgba(12, 26, 85, 0.8));
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      animation: autocompleteSlide 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
      border: 1px solid rgba(255,255,255,0.05);
      backdrop-filter: blur(10px);
    }

    .autocomplete-item img {
      width: 32px;
      height: 42px;
      object-fit: cover;
      border-radius: 4px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }

    .autocomplete-item:hover, .autocomplete-item.selected {
      background: linear-gradient(135deg, rgba(42, 92, 255, 0.7), rgba(4, 29, 130, 0.9));
      transform: translateX(6px) scale(1.02);
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.25);
      border-color: rgba(78, 125, 255, 0.3);
    }

    @keyframes autocompleteSlide {
      0% {
        opacity: 0;
        transform: translateX(-20px) scale(0.9);
      }
      100% {
        opacity: 1;
        transform: translateX(0) scale(1);
      }
    }

    .hint{
      font-size:11px; 
      color:#a6b6ff;
      opacity: 0.8;
      text-align: center;
    }

    /* Compact settings section */
    .settings-section {
      display: grid;
      gap: 10px;
      padding: 12px;
      background: rgba(11, 19, 43, 0.6);
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.08);
      backdrop-filter: blur(10px);
    }

    .settings-title {
      font-size: 14px;
      font-weight: 700;
      color: #ffe27a;
      text-align: center;
      margin-bottom: 4px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.5);
    }

    .setting-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      padding: 8px 12px;
      background: rgba(20, 48, 136, 0.3);
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,0.05);
      transition: all 0.3s ease;
    }

    .setting-row:hover {
      background: rgba(20, 48, 136, 0.5);
      transform: translateY(-1px);
    }

    .setting-label {
      font-size: 12px;
      font-weight: 600;
      color: #e7ecff;
      flex: 1;
    }

    .toggle-switch {
      position: relative;
      width: 44px;
      height: 22px;
      border-radius: 11px;
      border: none;
      cursor: pointer;
      outline: none;
      background: linear-gradient(135deg, #ff4d4d, #cc3333);
      transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
      flex-shrink: 0;
      box-shadow: 0 3px 8px rgba(0,0,0,0.2);
    }

    .toggle-switch::before {
      content: "";
      position: absolute;
      top: 2px;
      left: 2px;
      width: 18px;
      height: 18px;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(4px);
      border-radius: 50%;
      box-shadow: 
        inset 0 0 4px rgba(255,255,255,0.4),
        0 2px 6px rgba(0,0,0,0.3),
        0 0 8px rgba(255,255,255,0.4);
      transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .toggle-switch.active {
      background: linear-gradient(135deg, #27c46b, #1ea653);
    }

    .toggle-switch.active::before {
      transform: translateX(22px);
      box-shadow: 
        inset 0 0 4px rgba(255,255,255,0.4),
        0 2px 6px rgba(0,0,0,0.3),
        0 0 10px rgba(0,255,0,0.6);
    }

    /* Compact graphics quality selection */
    .graphics-selector {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 6px;
      margin-top: 4px;
    }

    .graphics-option {
      padding: 8px 12px;
      border-radius: 8px;
      border: 2px solid rgba(255,255,255,0.1);
      background: rgba(20, 48, 136, 0.4);
      color: #e7ecff;
      font-weight: 600;
      font-size: 11px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      backdrop-filter: blur(8px);
    }

    .graphics-option:hover {
      background: rgba(20, 48, 136, 0.6);
      transform: translateY(-1px);
    }

    .graphics-option.active {
      border-color: #4e7dff;
      background: linear-gradient(135deg, rgba(42, 92, 255, 0.6), rgba(4, 29, 130, 0.8));
      color: #fff;
      box-shadow: 0 0 15px rgba(78, 125, 255, 0.3);
    }

    .graphics-option.high {
      border-left: 3px solid #27c46b;
    }

    .graphics-option.low {
      border-left: 3px solid #ff6b6b;
    }

    .graphics-option div {
      margin-top: 2px;
      font-size: 9px;
      opacity: 0.8;
    }

    .footer{
      opacity:.85; 
      text-align:center; 
      font-size:11px;
      padding: 10px 0;
      border-top: 1px solid rgba(255,255,255,0.1);
      margin-top: 12px;
    }
    .footer a{color:#9ec1ff}

    /* Responsive improvements */
    @media (max-width: 900px) {
      .frame { padding: 12px; }
      .topbar { 
        flex-direction: column; 
        gap: 8px; 
        padding: 12px; 
      }
      .stats { 
        justify-content: center; 
        gap: 6px; 
      }
      .pill { 
        padding: 6px 10px; 
        font-size: 12px; 
      }
      .card-frame { max-width: 250px; }
      .main { gap: 12px; }
      .guess-row { flex-direction: column; }
      .btn { width: 100%; }
      .brand .logo { width: 48px; height: 48px; }
      .graphics-selector { grid-template-columns: 1fr; }
    }

    @media (max-width: 600px) {
      .wrap { padding: 5px; }
      .card-frame { max-width: 220px; }
      .sidebar { padding: 12px; }
      .input { padding: 10px 12px; }
      .settings-section { padding: 10px; }
      .pill { padding: 4px 8px; font-size: 11px; }
    }

    /* Compact layout optimizations */
    @media (min-height: 600px) and (max-height: 800px) {
      .frame { padding: 12px; }
      .main { min-height: 380px; }
      .sidebar { padding: 12px; gap: 8px; }
      .settings-section { padding: 8px; gap: 6px; }
    }

    @media (max-height: 600px) {
      .wrap { padding: 5px; }
      .frame { padding: 8px; }
      .main { min-height: 320px; gap: 8px; }
      .card-frame { max-width: 200px; }
      .sidebar { padding: 8px; gap: 6px; }
      .settings-section { padding: 6px; gap: 4px; }
      .topbar { padding: 8px 12px; }
    }
  </style>
</head>
<body>
<div class="stars"></div>
<div class="particles" id="particles"></div>

<!-- Loading Screen -->
<div class="loading-screen" id="loadingScreen">
  <div class="loading-content">
    <div class="loading-spinner"></div>
    <h2>Preparing Next Round...</h2>
    <p>Get ready for the next challenge!</p>
  </div>
</div>

<div class="wrap">
  <div class="frame">
    <div class="topbar">
      <div class="brand">
        <img src="assets/logo.png" alt="Logo" class="logo" />
      </div>
      <div class="stats">
        <div class="pill"><span>Score:</span>&nbsp;<b id="score">0</b></div>
        <div class="pill"><span>Round:</span>&nbsp;<b id="round">1</b></div>
        <div class="pill"><span>Pixels:</span>&nbsp;<b id="pixelInfo">6</b></div>
      </div>
    </div>

    <div class="main">
      <section class="stage">
        <div class="card-frame" id="cardFrame">
          <canvas id="pixelCanvas" width="600" height="800" aria-label="Clash Royale card"></canvas>
          <div class="confetti" id="confetti"></div>
          <span class="next-tag" id="nextTag" style="display:none;">Next!</span>
        </div>
        
        <div id="wrongGuesses" class="wrong-guesses"></div>
      </section>
      
      <aside class="sidebar">
        <form id="guessForm" class="guess-row" autocomplete="off">
          <input id="guessInput" class="input" placeholder="Guess card nameâ€¦ (e.g. Knight)" />
          <button class="btn" type="submit">Guess</button>
        </form>
        <div id="autocomplete"></div>

        <div class="hint">Tip: Start typing to get autocomplete suggestions.</div>

        <div class="status">
          <div>Difficulty Level</div>
          <div class="bar"><div id="difficultyBar"></div></div>
          <div id="statusText">Starting at 6 pixels.</div>
          <button class="btn" id="skipBtn">Give up</button>
          <button class="btn" id="resetBtn">Restart</button>
        </div>

        <div class="settings-section">
          <div class="settings-title">Game Settings</div>
          
          <div class="setting-row">
            <span class="setting-label">Graphics Quality</span>
          </div>
          <div class="graphics-selector">
            <div class="graphics-option high active" id="highGraphics">
              High Quality
              <div>Full effects & animations</div>
            </div>
            <div class="graphics-option low" id="lowGraphics">
              Performance Mode  
              <div>Reduced effects</div>
            </div>
          </div>

          <div class="setting-row">
            <span class="setting-label">Background Music</span>
            <button class="toggle-switch" id="musicToggle"></button>
          </div>
          
          <div class="setting-row">
            <span class="setting-label">Sound Effects</span>
            <button class="toggle-switch active" id="sfxToggle"></button>
          </div>
        </div>

        <div class="footer">
          <p>Pixel Royale</p>
        </div>
      </aside>
    </div>
  </div>
</div>

<div class="toast" id="toast" style="display:none">
  <div class="msg" id="toastMsg"></div>
</div>

<!-- Audio Elements -->
<audio id="correctSound" preload="auto">
  <source src="Correct.mp3" type="audio/mpeg">
</audio>
<audio id="wrongSound" preload="auto">
  <source src="Wrong.mp3" type="audio/mpeg">
</audio>
<audio id="buttonSound" preload="auto">
  <source src="Button.mp3" type="audio/mpeg">
</audio>
<audio id="transitionSound" preload="auto">
  <source src="sounds/transition.mp3" type="audio/mpeg">
  <source src="sounds/transition.wav" type="audio/wav">
</audio>
<audio id="bgMusic" loop>
  <source src="clashroyale.mp3" type="audio/mpeg">
</audio>

<script>
// Enhanced Pixel Royale with graphics quality settings

const DECK = [
 { name:"Knight", aliases:["Knight"], src:"https://i.ibb.co/x8RkNyrg/knight.png" },
  { name:"Archers", aliases:["Archer","Archers"], src:"https://i.ibb.co/JWTnrQH4/archers-Cb-WDu-Tf-Y.webp" },
  { name:"Giant", aliases:["Giant"], src:"https://i.ibb.co/ZRF3Nv33/giant-D9w-Wcvn6.webp" },
  { name:"Musketeer", aliases:["Musketeer"], src:"https://i.ibb.co/ymzGFZFy/musketeer-DQp-JQ7-Wk.webp" },
  { name:"Mini P.E.K.K.A", aliases:["Mini P.E.K.K.A","Mini Pekka","Pekka", "P.E.K.K.A"], src:"https://i.ibb.co/HfKD5BD1/mini-pekka-B5hr-QNV5.webp" },
  { name:"Wizard", aliases:["Wizard"], src:"https://i.ibb.co/5WS927SP/wizard-TZ61h-Fv-B.webp"},
  { name:"Prince", aliases:["Prince"], src:"https://i.ibb.co/Xk3GTpC3/prince-jc-Ls-Jr-Dj.webp" },
  { name:"Baby Dragon", aliases:["Baby Dragon", "dragon"], src:"https://i.ibb.co/ksq0SZG0/baby-dragon-BXNh-WASe.webp" },
  { name:"Hog Rider", aliases:["Hog Rider","Hogrider","Hog"], src:"https://i.ibb.co/4nJ0hJ96/hog-rider-Cd-UFl-G6b.webp" },
  { name:"Valkyrie", aliases:["Valkyrie"], src:"https://i.ibb.co/Rx6299s/valkyrie-fu-Rgla-Yj.webp" },
  { name:"Skeletons", aliases:["Skeletons"], src:"https://i.ibb.co/svks9yg2/skeletons.webp" },
  { name:"Goblins", aliases:["Goblins"], src:"https://i.ibb.co/hNbZjpZ/goblins.webp" },
  { name:"Spear Goblins", aliases:["Spear Goblins", "Goblin"], src:"https://i.ibb.co/DfbQzyDr/spear-goblins.webp" },
  { name:"Bomber", aliases:["Bomber"], src:"https://i.ibb.co/jvDPtMTY/bomber.webp" },
  { name:"Bats", aliases:["Bats"], src:"https://i.ibb.co/zV93Fgg5/bats.webp" },
  { name:"Zap", aliases:["Zap"], src:"https://i.ibb.co/7tQtZyYd/zap.webp" },
  { name:"Giant Snowball", aliases:["Giant Snowball", "Snowball"], src:"https://i.ibb.co/zVW76HFs/giant-snowball.webp" },
  { name:"Berserker", aliases:["Berserker"], src:"https://i.ibb.co/NgTFGLxL/berserker.webp" },
  { name:"Ice Spirit", aliases:["Ice Spirit", "Spirit"], src:"https://i.ibb.co/Lz3Mm7yD/ice-spirit.webp" },
  { name:"Fire Spirit", aliases:["Fire Spirit", "Spirit"], src:"https://i.ibb.co/fY3NRJsY/fire-spirit.webp" },
  { name:"Heal Spirit", aliases:["Heal Spirit", "Spirit"], src:"https://i.ibb.co/N6BTPvTg/heal-spirit.webp" },
  { name:"Arrows", aliases:["Arrows"], src:"https://i.ibb.co/Lz77X1QG/arrows.webp" },
  { name:"Skeleton Barrel", aliases:["Skeleton Barrel", "Barrel"], src:"https://i.ibb.co/Mxj8T9M5/skeleton-barrel.webp" },
  { name:"Firecracker", aliases:["Firecracker"], src:"https://i.ibb.co/GSYwVF8/firecracker.webp" },
  { name:"Mortar", aliases:["Mortar"], src:"https://i.ibb.co/W4rnkcP4/mortar.webp" },
  { name:"Cannon", aliases:["Cannon"], src:"https://i.ibb.co/Cs2hP1jh/cannon.webp" },
  { name:"Tesla", aliases:["Tesla"], src:"https://i.ibb.co/3mWZyk9z/tesla.webp" },
  { name:"Barbarians", aliases:["Barbarians"], src:"https://i.ibb.co/Nn6Y3nhg/barbarians.webp" },
  { name:"Royal Giant", aliases:["Royal Giant","Giant"], src:"https://i.ibb.co/LXpX550C/royalgiant.webp" },
  { name:"Royal Recruits", aliases:["Royal Recruits", "Recruits"], src:"https://i.ibb.co/j9DpNcnT/royal-recruits.webp" },
  { name:"Dart Goblin", aliases:["Dart Goblin", "Goblin"], src:"https://i.ibb.co/CKjYfH5d/dart-goblin.webp" },
  { name:"Goblin Cage", aliases:["Goblin Cage", "Cage"], src:"https://i.ibb.co/jPWkWDYP/goblin-cage.webp" },
  { name:"Battle Ram", aliases:["Battle Ram", "Ram"], src:"https://i.ibb.co/B2TBqLtj/battle-ram.webp" },
  { name:"Furnace", aliases:["Furnace"], src:"https://i.ibb.co/cXJLQ6qS/Furnace-Card.webp" },
  { name:"Wall Breakers", aliases:["Wall Breakers"], src:"https://i.ibb.co/r22cVXvK/wall-breakers.webp" },
  { name:"Goblin Barrel", aliases:["Goblin Barrel", "Barrel"], src:"https://i.ibb.co/ZzbrZyZz/goblin-barrel.webp" },
  { name:"Hunter", aliases:["Hunter"], src:"https://i.ibb.co/1fnY195B/hunter.webp" },
  { name:"Goblin Drill", aliases:["Goblin Drill", "Drill"], src:"https://i.ibb.co/hbDh9Y0/goblin-drill.webp" },
  { name:"Witch", aliases:["Witch"], src:"https://i.ibb.co/ZRBxd8TK/Witch-Card.webp" },
  { name:"Electro Dragon", aliases:["Electro Dragon", "Dragon"], src:"https://i.ibb.co/4ZmZ0n0M/electro-dragon.webp" },
  { name:"Executioner", aliases:["Executioner"], src:"https://i.ibb.co/k2KXxP3D/executioner.webp" },
  { name:"Goblin Giant", aliases:["Goblin Giant", "Giant"], src:"https://i.ibb.co/zh93Lg3B/goblin-giant.webp" },
  { name:"P.E.K.K.A", aliases:["P.E.K.K.A", "Pekka"], src:"https://i.ibb.co/cSCjQ619/pekka.webp" },
  { name:"Inferno Dragon", aliases:["Inferno Dragon", "Dragon"], src:"https://i.ibb.co/VpWPdt7m/inferno-dragon.webp" },
  { name:"Lumberjack", aliases:["Lumberjack"], src:"https://i.ibb.co/zWcqc162/lumberjack.webp" },
  { name:"Mega Knight", aliases:["Mega Knight", "Knight"], src:"https://i.ibb.co/Wv0VCYqt/mega-knight.webp" },
  { name:"Mirror", aliases:["Mirror"], src:"https://i.ibb.co/0RvBKd8L/mirror.webp" },
  { name:"Barbarian Barrel", aliases:["Barbarian Barrel", "Barrel"], src:"https://i.ibb.co/2YKGh1g7/barbarian-barrel.webp" },
  { name:"Clone", aliases:["Clone"], src:"https://i.ibb.co/cX1HDrfV/clone.webp" },  
  { name:"Void", aliases:["Void"], src:"https://i.ibb.co/DPVYh0fP/void.webp" },
  { name:"Dark Prince", aliases:["Dark Prince", "Prince"], src:"https://i.ibb.co/Gfn1Vvjw/dark-prince.webp" },
  { name:"Freeze", aliases:["Freeze"], src:"https://i.ibb.co/h1ZxkLn0/freeze.webp" },
  { name:"Poison", aliases:["Poison"], src:"https://i.ibb.co/7tjcjBS6/poison.webp" },
  { name:"Rune Giant", aliases:["Rune Giant", "Giant"], src:"https://i.ibb.co/qLqbSb20/rune-giant.webp" },
  { name:"Balloon", aliases:["Balloon"], src:"https://i.ibb.co/gb67HyXj/balloon.webp" },
  { name:"Bowler", aliases:["Bowler"], src:"https://i.ibb.co/0V2QjTLg/bowler.webp" },
  { name:"Cannon Cart", aliases:["Cannon Cart", "Cart"], src:"https://i.ibb.co/Cs0Sn7Qk/cannon-cart.webp" },
  { name:"Giant Skeleton", aliases:["Giant Skeleton", "Skeleton"], src:"https://i.ibb.co/wFPG6snC/giant-skeleton.webp" },
  { name:"Lightning", aliases:["Lightning"], src:"https://i.ibb.co/n8Bm5mfZ/lightning.webp" },
  { name:"X-Bow", aliases:["X-Bow", "xbow", "bow"], src:"https://i.ibb.co/WWd6tn3p/x-bow.webp" },
  { name:"Electro Giant", aliases:["Electro Giant", "Giant"], src:"https://i.ibb.co/6cy7yTGx/electro-giant.webp" },
  { name:"Golem", aliases:["Golem"], src:"https://i.ibb.co/VWgzNNWV/golem.webp" },
  { name:"Three Musketeers", aliases:["Three Musketeers", "Musketeers"], src:"https://i.ibb.co/C3vC2BB6/three-musketeers.webp" },
  { name:"Ice Golem", aliases:["Ice Golem", "Golem"], src:"https://i.ibb.co/n81csvCp/ice-golem.webp" },
  { name:"Suspicious Bush", aliases:["Suspicious Bush", "Bush"], src:"https://i.ibb.co/ym5HmhPm/suspicious-bush.webp" },
  { name:"Tombstone", aliases:["Tombstone"], src:"https://i.ibb.co/Fpv85CQ/tombstone.webp" },
  { name:"Mega Minion", aliases:["Mega Minion", "Minion"], src:"https://i.ibb.co/TDcRCG75/mega-minion.webp" },
  { name:"Earthquake", aliases:["Earthquake"], src:"https://i.ibb.co/NdkM8vcr/earthquake.webp" },
  { name:"Elixir Golem", aliases:["Elixir Golem", "Golem"], src:"https://i.ibb.co/Kc9mJtCP/elixir-golem.webp" },
  { name:"Flying Machine", aliases:["Flying Machine", "Machine"], src:"https://i.ibb.co/1J0VnHdb/flying-machine.webp" },
  { name:"Battle Healer", aliases:["Battle Healer", "Healer"], src:"https://i.ibb.co/tMVbYT4y/battle-healer.webp" },
  { name:"Zappies", aliases:["Zappies"], src:"https://i.ibb.co/hJg3ZNgZ/zappies.webp" },
  { name:"Goblin Demolisher", aliases:["Goblin Demolisher", "Demolisher"], src:"https://i.ibb.co/VYb2sJ6x/goblin-demolisher.webp" },
  { name:"Royal Hogs", aliases:["Royal Hogs", "Hogs"], src:"https://i.ibb.co/Zz7LszPg/royal-hogs.webp" },
  { name:"Rocket", aliases:["Rocket"], src:"https://i.ibb.co/DfbhmLnp/rocket.webp" },
  { name:"Elixir Collector", aliases:["Elixir Collector", "Collector"], src:"https://i.ibb.co/N6zbjKgg/elixir-collector.webp" },
  { name:"Minions", aliases:["Minions"], src:"https://i.ibb.co/0yvWKk07/minions.webp" },
  { name:"Skeleton Army", aliases:["Skeleton Army", "Army"], src:"https://i.ibb.co/PvgNJ0tL/skeleton-army.webp" },
  { name:"Fireball", aliases:["Fireball"], src:"https://i.ibb.co/4Q9LpX4/fireball.webp" },
  { name:"Elite Barbarians", aliases:["Elite Barbarians","Barbarians"], src:"https://i.ibb.co/zWV2GRvm/elite-barbarians.webp" },
  { name:"Minion Horde", aliases:["Minion Horde","Horde"], src:"https://i.ibb.co/1tDDjn55/minion-horde.webp" },
  { name:"Tornado", aliases:["Tornado"], src:"https://i.ibb.co/MyLdBQRB/tornado.webp" },
  { name:"Rage", aliases:["Rage"], src:"https://i.ibb.co/Zz36n4rj/rage.webp" },
  { name:"Princess", aliases:["Princess"], src:"https://i.ibb.co/hF2nDYJr/princess.webp" },
  { name:"Miner", aliases:["Miner"], src:"https://i.ibb.co/0RLymcGV/miner.webp" },
  { name:"The Log", aliases:["The Log","Log"], src:"https://i.ibb.co/GQsrQnV0/the-log.webp" },
  { name:"Sparky", aliases:["Sparky"], src:"https://i.ibb.co/NDZkkgn/sparky.webp" },
  { name:"Night Witch", aliases:["Night Witch","Witch"], src:"https://i.ibb.co/KzqY0qPs/Night-Witch-Card.webp" },
  { name:"Fisherman", aliases:["Fisherman"], src:"https://i.ibb.co/PZS9ZNBN/fisherman.webp" },
  { name:"Lava Hound", aliases:["Lava Hound","Hound"], src:"https://i.ibb.co/dJpY7Ds5/lava-hound.webp" },
  { name:"Graveyard", aliases:["Graveyard"], src:"https://i.ibb.co/ycmkmYgL/graveyard.webp" },
  { name:"Ice Wizard", aliases:["Ice Wizard","Wizard"], src:"https://i.ibb.co/v6VW4JtM/ice-wizard.webp" },
  { name:"Royal Ghost", aliases:["Royal Ghost","Ghost"], src:"https://i.ibb.co/Q7sjR5gt/royal-ghost.webp" },
  { name:"Bandit", aliases:["Bandit"], src:"https://i.ibb.co/qMsTtBGM/bandit.webp" },
  { name:"Magic Archer", aliases:["Magic Archer","Archer"], src:"https://i.ibb.co/nsdMpXzw/magic-archer.webp" },
  { name:"Phoenix", aliases:["Phoenix"], src:"https://i.ibb.co/B5fb714j/pheonix.webp" },
  { name:"Archer Queen", aliases:["Archer Queen","Queen"], src:"https://i.ibb.co/XfyVgJ6h/archer-queen.webp" },
  { name:"Golden Knight", aliases:["Golden Knight","Knight"], src:"https://i.ibb.co/DPXJ27KQ/golden-knight.webp" },
  { name:"Skeleton King", aliases:["Skeleton King","King"], src:"https://i.ibb.co/v6vLKmp7/skeleton-king.webp" },
  { name:"Mighty Miner", aliases:["Mighty Miner","Miner"], src:"https://i.ibb.co/mndp3FZ/mighty-miner.webp" },
  { name:"Little Prince", aliases:["Little Prince","Prince"], src:"https://i.ibb.co/QFjn4y0R/little-prince.webp" },
  { name:"Monk", aliases:["Monk"], src:"https://i.ibb.co/JRyqY1J8/monk.webp" },
  { name:"Inferno Tower", aliases:["Inferno Tower","Tower"], src:"https://i.ibb.co/wNqcYVR3/inferno-tower.webp" },
  { name:"Bomb Tower", aliases:["Bomb Tower", "Tower"], src:"https://i.ibb.co/r2XGts3p/bomb-tower.webp" },
  { name:"Goblin Hut", aliases:["Goblin Hut","Hut"], src:"https://i.ibb.co/PGjfPj3q/goblin-hut.webp" },
  { name:"Barbarian Hut", aliases:["Barbarian Hut", "Hut"], src:"https://i.ibb.co/xKhKsf1v/barbarian-hut.webp" },
  { name:"Royal Delivery", aliases:["Royal Delivery", "Delivery"], src:"https://i.ibb.co/x8rCnXBB/royal-delivery.webp" },
  { name:"Vines", aliases:["Vines"], src:"https://i.ibb.co/1GvDNRkC/vines.webp" },
  { name:"Goblin Curse", aliases:["Goblin Curse","Curse"], src:"https://i.ibb.co/Z63jFrM2/goblin-curse.webp" },
  { name:"Electro Wizard", aliases:["Electro Wizard, Wizard"], src:"https://i.ibb.co/GfHjbMJL/electro-wizard.webp" },
  { name:"Skeleton Dragon", aliases:["Skeleton, Dragon"], src:"https://i.ibb.co/nqZyK5Wk/skeleton-dragons.webp" } 
];

const START_PIXELS = 6;
const PIXEL_STEP = 6;
const MAX_PIXELS = 400;

let score = 0, round = 1, difficultyPixels = START_PIXELS;
let order = shuffle([...DECK.keys()]);
let cursor = 0;
let musicEnabled = false, sfxEnabled = true;
let wrongGuesses = [];
let graphicsQuality = 'high'; // 'high' or 'low'

// Audio elements
const sounds = {
  correct: document.getElementById('correctSound'),
  wrong: document.getElementById('wrongSound'),
  button: document.getElementById('buttonSound'),
  transition: document.getElementById('transitionSound'),
  bgMusic: document.getElementById('bgMusic')
};

// Set initial volume levels
Object.values(sounds).forEach(audio => {
  if (audio) {
    audio.volume = audio.id === 'bgMusic' ? 0.3 : 0.5;
  }
});

// Enhanced particle system for high graphics mode
function createParticles() {
  if (graphicsQuality === 'low') return;
  
  const particlesContainer = document.getElementById('particles');
  
  setInterval(() => {
    if (document.documentElement.getAttribute('data-graphics') === 'low') return;
    
    const particle = document.createElement('div');
    particle.className = 'particle';
    
    // Random starting position
    particle.style.left = Math.random() * 100 + 'vw';
    particle.style.animationDuration = (Math.random() * 6 + 4) + 's';
    particle.style.animationDelay = Math.random() * 2 + 's';
    
    // Random colors
    const colors = ['#ff0080', '#00ffff', '#ffcc33', '#8a2be2'];
    particle.style.background = colors[Math.floor(Math.random() * colors.length)];
    
    particlesContainer.appendChild(particle);
    
    // Remove particle after animation
    setTimeout(() => {
      if (particlesContainer.contains(particle)) {
        particlesContainer.removeChild(particle);
      }
    }, 10000);
  }, 800);
}

// Graphics quality management
function setGraphicsQuality(quality) {
  graphicsQuality = quality;
  const root = document.documentElement;
  
  if (quality === 'low') {
    root.setAttribute('data-graphics', 'low');
    // Clear existing particles
    document.getElementById('particles').innerHTML = '';
  } else {
    root.removeAttribute('data-graphics');
    createParticles(); // Restart particle system
  }
  
  // Update UI
  document.getElementById('highGraphics').classList.toggle('active', quality === 'high');
  document.getElementById('lowGraphics').classList.toggle('active', quality === 'low');
  
  // Save preference
  localStorage.setItem('pixelRoyale_graphics', quality);
}

// Load saved graphics preference
function loadGraphicsPreference() {
  const saved = localStorage.getItem('pixelRoyale_graphics');
  if (saved && (saved === 'high' || saved === 'low')) {
    setGraphicsQuality(saved);
  }
}

// Simple audio playback function
function playSound(type) {
  if (!sfxEnabled && type !== 'bgMusic') return;
  if (!musicEnabled && type === 'bgMusic') return;
  
  const audio = sounds[type];
  if (audio) {
    audio.currentTime = 0;
    audio.play().catch(() => {});
  }
}

function stopSound(type) {
  const audio = sounds[type];
  if (audio) {
    audio.pause();
    audio.currentTime = 0;
  }
}

// Enhanced loading screen
function showLoadingScreen() {
  const loadingScreen = document.getElementById('loadingScreen');
  loadingScreen.classList.add('active');
  playSound('transition');
  
  return new Promise(resolve => {
    setTimeout(() => {
      loadingScreen.classList.remove('active');
      resolve();
    }, 2000);
  });
}

// DOM Elements
const canvas = document.getElementById('pixelCanvas');
const ctx = canvas.getContext('2d');
const pixelInfo = document.getElementById('pixelInfo');
const scoreEl = document.getElementById('score');
const roundEl = document.getElementById('round');
const statusText = document.getElementById('statusText');
const diffBar = document.getElementById('difficultyBar');
const nextTag = document.getElementById('nextTag');
const guessForm = document.getElementById('guessForm');
const guessInput = document.getElementById('guessInput');
const skipBtn = document.getElementById('skipBtn');
const resetBtn = document.getElementById('resetBtn');
const toast = document.getElementById('toast');
const toastMsg = document.getElementById('toastMsg');
const confettiBox = document.getElementById('confetti');
const cardFrame = document.getElementById('cardFrame');
const autocompleteDiv = document.getElementById('autocomplete');
const wrongGuessesDiv = document.getElementById('wrongGuesses');
const loadingScreen = document.getElementById('loadingScreen');

// Settings controls
const musicToggle = document.getElementById('musicToggle');
const sfxToggle = document.getElementById('sfxToggle');
const highGraphics = document.getElementById('highGraphics');
const lowGraphics = document.getElementById('lowGraphics');

let currentImage = new Image();
currentImage.crossOrigin = 'anonymous';

// Initialize game
loadGraphicsPreference();
loadCurrentCard();
updateUI();

// Graphics quality event listeners
highGraphics.addEventListener('click', () => {
  playSound('button');
  setGraphicsQuality('high');
  notify('High graphics enabled! Full visual effects active.', 2000);
});

lowGraphics.addEventListener('click', () => {
  playSound('button');
  setGraphicsQuality('low');
  notify('Performance mode enabled! Optimized for smooth gameplay.', 2000);
});

// Toggle event listeners
musicToggle.addEventListener('click', () => {
  playSound('button');
  musicEnabled = !musicEnabled;
  musicToggle.classList.toggle('active', musicEnabled);
  
  if (musicEnabled) {
    playSound('bgMusic');
  } else {
    stopSound('bgMusic');
  }
});

sfxToggle.addEventListener('click', () => {
  if (sfxEnabled) playSound('button'); // Play before disabling
  sfxEnabled = !sfxEnabled;
  sfxToggle.classList.toggle('active', sfxEnabled);
});

function shuffle(arr){
  for(let i=arr.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]]=[arr[j],arr[i]];
  }
  return arr;
}

function currentCard(){ 
  return DECK[order[cursor % order.length]]; 
}

async function nextCard(){
  cursor++;
  round++;
  nextTag.style.display='none';
  cardFrame.classList.remove('revealed');
  
  if(cursor % order.length === 0){ 
    order = shuffle(order); 
  }
  
  // Show loading screen
  await showLoadingScreen();
  
  loadCurrentCard();
  updateUI();
}

function loadCurrentCard(){
  const card = currentCard();
  currentImage = new Image();
  currentImage.crossOrigin = 'anonymous';
  currentImage.onload = ()=> drawPixelated(currentImage, difficultyPixels);
  currentImage.src = card.src;
}

function drawPixelated(img, pixels){
  const aspect = 3/4;
  const targetBlocks = Math.max(6, Math.min(pixels, MAX_PIXELS));
  let cols = Math.max(3, Math.round(Math.sqrt(targetBlocks*aspect)));
  let rows = Math.max(2, Math.round(cols / aspect));
  const w = cols, h = rows;
  
  const off = document.createElement('canvas'); 
  off.width = w; off.height = h;
  const octx = off.getContext('2d');
  const {sx, sy, sw, sh} = cover(img.width, img.height, w, h);
  octx.drawImage(img, sx, sy, sw, sh, 0, 0, w, h);
  
  ctx.imageSmoothingEnabled = false;
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.drawImage(off, 0, 0, w, h, 0, 0, canvas.width, canvas.height);
  pixelInfo.textContent = targetBlocks;
}

function cover(srcW, srcH, destW, destH){
  const srcRatio = srcW/srcH, destRatio = destW/destH;
  let newW, newH;
  if(destRatio > srcRatio){
    newW=srcW; newH=srcW/destRatio;
  } else {
    newH=srcH; newW=srcH*destRatio;
  }
  const sx=(srcW-newW)/2; 
  const sy=(srcH-newH)/2;
  return {sx, sy, sw:newW, sh:newH};
}

// Form handling
guessForm.addEventListener('submit', e => {
  e.preventDefault();
  const guess = guessInput.value.trim();
  if (!guess) return;

  const allAliases = DECK.flatMap(c => c.aliases.map(a => a.toLowerCase()));
  if (!allAliases.includes(guess.toLowerCase())) {
    notify("Invalid card name!", 1500);
    wrongAnimation();
    playSound('wrong');
    guessInput.value = '';
    return;
  }

  const card = currentCard();
  if (card.aliases.some(a => a.toLowerCase() === guess.toLowerCase())) {
    handleRight();
  } else {
    handleWrong(guess);
  }

  guessInput.value = '';
  autocompleteDiv.innerHTML = '';
});

skipBtn.addEventListener('click', () => {
  revealCard();
  resetDifficulty();
  wrongGuesses = [];
  wrongGuessesDiv.innerHTML = '';
  
  nextTag.style.display = 'block';
  setTimeout(() => { nextCard(); }, 2500);
});

resetBtn.addEventListener('click', () => {
  playSound('button');
  location.reload();
});

function revealCard() {
  notify(`ðŸ’¡ The card was: ${currentCard().name}`, 3000);
  playSound('transition');
  
  // Show full card with enhanced effects in high graphics mode
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.drawImage(currentImage, 0, 0, canvas.width, canvas.height);
  cardFrame.classList.add('revealed');
  
  if (graphicsQuality === 'high') {
    cardFrame.classList.add('success-glow');
    setTimeout(() => cardFrame.classList.remove('success-glow'), 1500);
  }
}

async function handleRight(){
  playSound('correct');
  rightAnimation();
  score++;
  notify('Correct! Amazing guess!', 2000);
  
  revealCard();
  resetDifficulty();
  wrongGuesses = [];
  wrongGuessesDiv.innerHTML = '';

  nextTag.style.display = 'block';
  setTimeout(() => { nextCard(); }, 2500);
}

function handleWrong(guess){
  playSound('wrong');
  wrongAnimation();
  notify('Wrong! The image becomes clearer.', 1500);
  increaseDifficulty();
  drawPixelated(currentImage, difficultyPixels);

  const card = DECK.find(c => c.aliases.some(a => a.toLowerCase() === guess.toLowerCase()));
  if (card && !wrongGuesses.includes(card.name)){
    wrongGuesses.push(card.name);
    const item = document.createElement('div');
    item.innerHTML = `<img src="${card.src}" alt="${card.name}" loading="lazy"><span>${card.name}</span>`;
    wrongGuessesDiv.appendChild(item);
  }
}

function resetDifficulty(){ 
  difficultyPixels = START_PIXELS; 
  updateUI(); 
}

function increaseDifficulty(){ 
  difficultyPixels = Math.min(MAX_PIXELS, difficultyPixels + PIXEL_STEP); 
  updateUI(); 
}

function updateUI(){
  scoreEl.textContent = score;
  roundEl.textContent = round;
  pixelInfo.textContent = difficultyPixels;
  diffBar.style.width = `${Math.min(100, difficultyPixels/MAX_PIXELS*100)}%`;
  statusText.textContent = `Clarity: ${difficultyPixels} pixels`;
}

function notify(msg, ms=2000){ 
  toastMsg.textContent = msg; 
  toast.style.display = 'grid'; 
  setTimeout(() => toast.style.display = 'none', ms); 
}

function wrongAnimation(){ 
  cardFrame.classList.remove('shake'); 
  void cardFrame.offsetWidth; 
  cardFrame.classList.add('shake'); 
}

function rightAnimation(){
  // Enhanced confetti based on graphics quality
  confettiBox.innerHTML = '';
  const colors = ['#ffcc33', '#ff6b9d', '#4ecdc4', '#45b7d1', '#96ceb4', '#ffeaa7'];
  const particleCount = graphicsQuality === 'high' ? 50 : 20;
  
  for(let i = 0; i < particleCount; i++){
    const piece = document.createElement('div');
    piece.style.position = 'absolute';
    piece.style.left = `${50 + Math.random() * 60 - 30}%`;
    piece.style.top = '50%';
    piece.style.width = piece.style.height = `${Math.random() * 8 + 4}px`;
    piece.style.background = colors[Math.floor(Math.random() * colors.length)];
    piece.style.borderRadius = Math.random() > 0.5 ? '50%' : '2px';
    piece.style.opacity = 0.9;
    piece.style.zIndex = '10';
    confettiBox.appendChild(piece);
    
    if (graphicsQuality === 'high') {
      animateConfettiAdvanced(piece);
    } else {
      animateConfettiSimple(piece);
    }
  }
  
  setTimeout(() => confettiBox.innerHTML = '', graphicsQuality === 'high' ? 1200 : 800);
}

function animateConfettiAdvanced(el){
  const x = (Math.random() - 0.5) * 600; 
  const y = -300 - Math.random() * 200;
  const rotation = Math.random() * 1080;
  const duration = 800 + Math.random() * 600;
  
  el.animate([
    {
      transform: `translate(0,0) rotate(0deg)`,
      opacity: 0.9
    },
    {
      transform: `translate(${x}px,${y}px) rotate(${rotation}deg)`,
      opacity: 0
    }
  ], {
    duration: duration, 
    easing: 'cubic-bezier(0.25, 0.46, 0.45, 0.94)'
  });
}

function animateConfettiSimple(el){
  const x = (Math.random() - 0.5) * 300; 
  const y = -200 - Math.random() * 100;
  const duration = 600 + Math.random() * 200;
  
  el.animate([
    { transform: 'translate(0,0)', opacity: 1 },
    { transform: `translate(${x}px,${y}px)`, opacity: 0 }
  ], {
    duration: duration,
    easing: 'ease-out'
  });
}

// Enhanced autocomplete
guessInput.addEventListener('input', () => {
  const query = guessInput.value.trim().toLowerCase();
  autocompleteDiv.innerHTML = '';

  if (!query) return;

  const matches = DECK.filter(card => {
    const nameMatch = card.name.toLowerCase().startsWith(query);
    const aliasMatch = card.aliases?.some(alias => alias.toLowerCase().startsWith(query));
    return nameMatch || aliasMatch;
  }).slice(0, 5);

  matches.forEach((card, index) => {
    const item = document.createElement('div');
    item.className = 'autocomplete-item';
    
    if (graphicsQuality === 'high') {
      item.style.animationDelay = `${index * 0.05}s`;
    }

    const img = document.createElement('img');
    img.src = card.src;
    img.loading = 'lazy';

    const span = document.createElement('span');
    span.textContent = card.name;

    item.appendChild(img);
    item.appendChild(span);

    item.addEventListener('click', () => {
      playSound('button');
      guessInput.value = card.name;
      autocompleteDiv.innerHTML = '';
      guessInput.focus();
    });

    autocompleteDiv.appendChild(item);
  });
});

// Hide autocomplete when clicking outside
document.addEventListener('click', (e) => {
  if (!autocompleteDiv.contains(e.target) && e.target !== guessInput) {
    autocompleteDiv.innerHTML = '';
  }
});

// Enhanced keyboard navigation
guessInput.addEventListener('keydown', (e) => {
  const items = autocompleteDiv.querySelectorAll('.autocomplete-item');
  if (items.length === 0) return;
  
  let currentIndex = Array.from(items).findIndex(item => item.classList.contains('selected'));
  
  switch(e.key) {
    case 'ArrowDown':
      e.preventDefault();
      if (currentIndex < items.length - 1) currentIndex++;
      else currentIndex = 0;
      break;
    case 'ArrowUp':
      e.preventDefault();
      if (currentIndex > 0) currentIndex--;
      else currentIndex = items.length - 1;
      break;
    case 'Tab':
    case 'Enter':
      if (e.key === 'Tab') e.preventDefault();
      if (currentIndex >= 0 && e.key !== 'Enter') {
        items[currentIndex].click();
        return;
      }
      break;
    case 'Escape':
      autocompleteDiv.innerHTML = '';
      return;
    default:
      return;
  }
  
  // Update selection
  items.forEach(item => item.classList.remove('selected'));
  if (currentIndex >= 0) {
    items[currentIndex].classList.add('selected');
    items[currentIndex].scrollIntoView({ block: 'nearest' });
  }
});

// Add click sounds to buttons
document.querySelectorAll('.btn').forEach(button => {
  button.addEventListener('click', () => playSound('button'));
});

// Enable audio context on first interaction
document.addEventListener('click', () => {
  Object.values(sounds).forEach(audio => {
    if (audio && audio.play) {
      audio.play().then(() => audio.pause()).catch(() => {});
    }
  });
}, { once: true });

console.log('Pixel Royale loaded successfully!');
</script>
</body>
</html>